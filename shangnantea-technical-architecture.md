# 商南茶文化平台技术架构设计

## 总体架构

商南茶文化平台采用经典的前后端分离架构，整体技术架构如下：

```
客户端层 → 前端应用层 → API网关层 → 业务服务层 → 数据持久层 → 数据存储层
```

![架构图](https://via.placeholder.com/800x400.png?text=ShangnanTea+Architecture)

## 技术栈选择

### 前端技术栈
- **框架**：Vue.js 2.x + Element-UI
- **构建工具**：Vue CLI
- **状态管理**：Vuex
- **路由管理**：Vue Router
- **HTTP客户端**：Axios
- **UI组件库**：Element-UI
- **CSS预处理器**：SCSS

### 后端技术栈
- **框架**：Spring Boot 2.7.x
- **ORM框架**：MyBatis
- **API文档**：Swagger/SpringDoc
- **安全框架**：Spring Security + JWT
- **缓存**：Redis
- **消息队列**：(可选) RabbitMQ
- **数据库**：MySQL 8.0

### 开发与部署工具
- **构建工具**：Maven
- **版本控制**：Git
- **CI/CD**：Jenkins
- **容器化**：Docker
- **监控**：Spring Boot Actuator

## 系统模块划分

系统分为以下主要模块：

1. **shangnantea-web**: 前端Vue应用
2. **shangnantea-server**: 后端服务应用
   - API控制器
   - 业务服务
   - 数据访问层
   - 公共组件

## 数据流设计

### 1. HTTP请求流程

```
浏览器/客户端 → 发送HTTP请求 → 
前端路由拦截 → JWT验证 → 
API请求 → 后端控制器 → 
业务服务处理 → 数据访问层 → 
数据库操作 → 返回数据 → 
控制器封装响应 → 前端处理展示
```

### 2. 认证授权流程

认证和授权功能已集成至UserController中，包含以下关键部分：

1. **认证流程**：
   - 用户通过UserController的登录接口提交凭证
   - 服务器验证凭证，成功后生成JWT令牌
   - 令牌包含用户ID、角色等关键信息
   - 客户端存储令牌用于后续请求

2. **授权控制**：
   - 基于角色的访问控制 (RBAC)
   - 用户角色决定可访问资源
   - API接口级别的权限控制
   - 前端UI元素根据权限动态显示/隐藏

### 3. 业务数据流

以下是典型业务流程的数据流向：

#### 3.1 茶叶浏览流程

```
用户访问茶叶列表 → 前端发起API请求 →
TeaController接收请求 → 
TeaService查询数据 (可能调用TeaCategoryService、TeaImageService等) →
TeaMapper执行数据库查询 →
返回茶叶列表数据 → 前端渲染展示
```

#### 3.2 订单创建流程

```
用户提交订单 → 前端验证表单 → 发送创建订单请求 →
OrderController接收请求 → 
OrderProcessingService处理订单创建逻辑 →
(调用多个服务: OrderService、CartService、TeaService) →
事务控制下执行多个数据库操作 →
返回订单创建结果 → 前端跳转支付页面
```

#### 3.3 用户注册流程

```
用户填写注册表单 → 前端验证 → 发送注册请求 →
AuthController接收请求 →
UserAuthService处理注册逻辑 →
UserService保存用户数据 →
UserMapper执行数据库插入 →
返回注册结果 → 前端处理响应
```

## 数据库设计理念

### 1. 表设计规范

- 表名使用复数形式，如`users`、`teas`
- 主键统一使用`id`命名
- 所有表添加`create_time`和`update_time`
- 使用软删除策略，添加`is_deleted`或`status`字段
- 外键关联使用`xxx_id`命名规则

### 2. 数据访问层设计

- 基础CRUD操作通过`BaseMapper`接口提供
- 复杂查询通过自定义SQL实现
- 所有Mapper文件遵循统一规范
- 分页查询统一使用MyBatis分页插件

## 系统安全设计

### 1. 身份认证

- 基于JWT的无状态认证
- 令牌包含用户ID、角色、权限等信息
- 令牌有效期控制和刷新机制
- 敏感操作二次验证

### 2. 数据安全

- 用户密码加密存储(BCrypt)
- API参数验证和消毒
- SQL注入防护
- XSS防护
- CSRF防护

### 3. 接口安全

- 接口限流防护
- 操作审计日志
- 异常日志记录和警报
- 数据加密传输(HTTPS)

## 性能优化设计

### 1. 数据库优化

- 合理索引设计
- 大数据分页查询
- 批量操作优化
- 读写分离准备

### 2. 应用层优化

- 热点数据缓存
- 合理的连接池配置
- 异步处理非关键流程
- JVM参数优化

### 3. 前端优化

- 资源压缩和CDN分发
- 图片懒加载
- 大列表虚拟滚动
- 组件按需加载

## 可扩展性设计

### 1. 代码层面

- 模块化和组件化设计
- 统一的异常处理机制
- 统一的结果封装
- AOP实现横切关注点

### 2. 架构层面

- 接口版本控制
- 微服务架构准备
- 服务无状态设计
- 配置外部化

## 部署架构

### 开发环境
- 本地开发工具
- 本地数据库
- 本地Redis

### 测试环境
- 测试服务器
- 测试数据库
- 测试缓存服务

### 生产环境
- 应用服务器集群
- 数据库主从
- Redis集群
- Nginx负载均衡

## 技术架构演进计划

### 第一阶段
- 单体应用架构
- 完整功能实现
- 基本性能优化

### 第二阶段
- 引入缓存提升性能
- 完善监控和日志系统
- 安全加固

### 第三阶段
- 负载均衡
- 读写分离
- 服务集群化

### 未来规划
- 微服务改造
- 容器化部署
- 云原生架构 