# E2E æµ‹è¯•æ–‡æ¡£

## ğŸ“– æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«å•†å—èŒ¶åŸé¡¹ç›®çš„ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æµ‹è¯•ï¼Œé‡‡ç”¨ **API ä¸­å¿ƒåŒ–æµ‹è¯•ç­–ç•¥**ã€‚

### æµ‹è¯•ç­–ç•¥

**æ ¸å¿ƒç†å¿µ**: 166 ä¸ª API = 166 ä¸ªæµ‹è¯•

æ¯ä¸ª API ç«¯ç‚¹å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•ï¼Œæµ‹è¯•æˆåŠŸæ ‡å‡†ï¼š
1. âœ… API è°ƒç”¨æˆåŠŸï¼ˆè¿”å›æ­£ç¡®çš„ä¸šåŠ¡çŠ¶æ€ç ï¼‰
2. âœ… æ— æ§åˆ¶å°é”™è¯¯

### ä¸ºä»€ä¹ˆé€‰æ‹© API æµ‹è¯•ï¼Ÿ

ç›¸æ¯”ä¼ ç»Ÿçš„ UI æµ‹è¯•ï¼ŒAPI æµ‹è¯•å…·æœ‰ï¼š
- âœ… **æ›´é«˜çš„ç¨³å®šæ€§** - ä¸ä¾èµ– UI å…ƒç´ é€‰æ‹©å™¨
- âœ… **æ›´å¿«çš„æ‰§è¡Œé€Ÿåº¦** - ç›´æ¥ç›‘æ§ç½‘ç»œè¯·æ±‚
- âœ… **æ›´ä½çš„ç»´æŠ¤æˆæœ¬** - API å˜åŒ–è¾ƒå°‘
- âœ… **æ›´å…¨é¢çš„è¦†ç›–** - æ‰€æœ‰ API éƒ½èƒ½æµ‹è¯•åˆ°

## ğŸ“ ç›®å½•ç»“æ„

```
e2e/
â”œâ”€â”€ api-tests/                          # API æµ‹è¯•ï¼ˆæ–°ï¼‰
â”‚   â”œâ”€â”€ user/                           # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ login.spec.js               # âœ… ç”¨æˆ·ç™»å½•
â”‚   â”‚   â”œâ”€â”€ register.spec.js            # âœ… ç”¨æˆ·æ³¨å†Œ
â”‚   â”‚   â””â”€â”€ ...                         # å…¶ä»–ç”¨æˆ· API
â”‚   â”œâ”€â”€ tea/                            # èŒ¶å¶æ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ order/                          # è®¢å•æ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ forum/                          # è®ºå›æ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ shop/                           # åº—é“ºæ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ message/                        # æ¶ˆæ¯æ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ API-TEST-TEMPLATE.md            # æµ‹è¯•æ¨¡æ¿
â”‚
â”œâ”€â”€ helpers/                            # è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ api-helper.js                   # API ç›‘æ§å·¥å…·
â”‚   â”œâ”€â”€ auth-helper.js                  # è®¤è¯è¾…åŠ©
â”‚   â””â”€â”€ error-collector.js              # é”™è¯¯æ”¶é›†å™¨
â”‚
â”œâ”€â”€ fixtures/                           # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ test-data.json                  # æµ‹è¯•ç”¨æ•°æ®
â”‚
â”œâ”€â”€ console-error-scan.spec.js          # æ—§çš„æµ…å±‚æ‰«ææµ‹è¯•
â”œâ”€â”€ user-module.spec.js                 # æ—§çš„ç”¨æˆ·æ¨¡å—æµ‹è¯•
â”‚
â”œâ”€â”€ run-api-test.bat                    # API æµ‹è¯•å¯åŠ¨è„šæœ¬ â­
â”œâ”€â”€ run-test.bat                        # è¿è¡Œæ‰€æœ‰æµ‹è¯•
â”œâ”€â”€ run-scan-test.bat                   # è¿è¡Œæµ…å±‚æ‰«æ
â”œâ”€â”€ run-user-test.bat                   # è¿è¡Œç”¨æˆ·æ¨¡å—æµ‹è¯•
â”œâ”€â”€ run-e2e.ps1                         # PowerShell æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ QUICK-START.md                      # å¿«é€Ÿå¼€å§‹æŒ‡å— â­
â”œâ”€â”€ API-TESTING-GUIDE.md                # å®Œæ•´æµ‹è¯•æŒ‡å— â­
â”œâ”€â”€ API-TEST-TEMPLATE.md                # æµ‹è¯•æ¨¡æ¿
â”œâ”€â”€ API-TEST-IMPLEMENTATION-STATUS.md   # å®æ–½çŠ¶æ€
â”œâ”€â”€ HOW-TO-RUN.md                       # è¿è¡Œè¯´æ˜
â””â”€â”€ README.md                           # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
cd shangnantea/shangnantea-web
npm run dev
```

### 2. è¿è¡Œæµ‹è¯•

```bash
cd e2e

# è¿è¡Œç”¨æˆ·ç™»å½•æµ‹è¯•
run-api-test.bat user/login

# è¿è¡Œç”¨æˆ·æ³¨å†Œæµ‹è¯•
run-api-test.bat user/register

# è¿è¡Œæ‰€æœ‰ç”¨æˆ·æ¨¡å—æµ‹è¯•
run-api-test.bat user

# è¿è¡Œæ‰€æœ‰ API æµ‹è¯•
run-api-test.bat
```

### 3. æŸ¥çœ‹ç»“æœ

- **æ§åˆ¶å°**: å®æ—¶æµ‹è¯•ç»“æœ
- **JSON æŠ¥å‘Š**: `e2e-report/api-tests/*.json`
- **é”™è¯¯æˆªå›¾**: `e2e-screenshots/*.png`

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ–°æ‰‹å…¥é—¨

1. **[QUICK-START.md](QUICK-START.md)** â­ æ¨èé¦–å…ˆé˜…è¯»
   - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
   - åˆ›å»ºæ–°æµ‹è¯•çš„ 3 ä¸ªæ­¥éª¤
   - å¸¸ç”¨ä»£ç æ¨¡å¼
   - å¸¸è§é—®é¢˜è§£ç­”

### æ·±å…¥å­¦ä¹ 

2. **[API-TESTING-GUIDE.md](API-TESTING-GUIDE.md)** â­ å®Œæ•´æŒ‡å—
   - æµ‹è¯•ç­–ç•¥è¯¦è§£
   - ç›®å½•ç»“æ„è¯´æ˜
   - API åˆ—è¡¨ä¸è¿›åº¦
   - å®æ–½è®¡åˆ’
   - æœ€ä½³å®è·µ

3. **[API-TEST-TEMPLATE.md](API-TEST-TEMPLATE.md)** æµ‹è¯•æ¨¡æ¿
   - å®Œæ•´çš„æµ‹è¯•æ¨¡æ¿ä»£ç 
   - æµ‹è¯•ç¼–å†™æŒ‡å—
   - éªŒè¯æ ‡å‡†

### è¿›åº¦è·Ÿè¸ª

4. **[API-TEST-IMPLEMENTATION-STATUS.md](API-TEST-IMPLEMENTATION-STATUS.md)** å®æ–½çŠ¶æ€
   - æ€»ä½“è¿›åº¦
   - å·²å®Œæˆçš„æµ‹è¯•
   - å¾…å®ç°çš„æµ‹è¯•
   - ä¸‹ä¸€æ­¥è®¡åˆ’

## ğŸ“Š å½“å‰è¿›åº¦

- **æ€» API æ•°é‡**: 166
- **å·²å®Œæˆ**: 2 (1.2%)
  - âœ… POST /user/login - ç”¨æˆ·ç™»å½•
  - âœ… POST /user/register - ç”¨æˆ·æ³¨å†Œ
- **å¾…å®ç°**: 164

## ğŸ¯ ä¸‹ä¸€æ­¥

### ä¼˜å…ˆå®ç°çš„ APIï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰

1. â³ GET /user/me - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
2. â³ GET /tea/list - è·å–èŒ¶å¶åˆ—è¡¨
3. â³ GET /tea/{id} - è·å–èŒ¶å¶è¯¦æƒ…
4. â³ POST /order - åˆ›å»ºè®¢å•
5. â³ POST /order/{id}/pay - æ”¯ä»˜è®¢å•

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: [Playwright](https://playwright.dev/)
- **è¯­è¨€**: JavaScript (Node.js)
- **æŠ¥å‘Šæ ¼å¼**: JSON
- **è®¤è¯æ–¹å¼**: Mock JWT Token

## ğŸ“ æµ‹è¯•ç¼–å†™æµç¨‹

1. ä» `openapi_new.yaml` æ‰¾åˆ° API å®šä¹‰
2. å¤åˆ¶æµ‹è¯•æ¨¡æ¿
3. ä¿®æ”¹ API è·¯å¾„ã€æ–¹æ³•ã€çŠ¶æ€ç 
4. å®ç°è§¦å‘é€»è¾‘ï¼ˆç‚¹å‡»æŒ‰é’®ã€å¡«å†™è¡¨å•ç­‰ï¼‰
5. è¿è¡Œæµ‹è¯•éªŒè¯
6. æ›´æ–°å®æ–½çŠ¶æ€æ–‡æ¡£

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ [QUICK-START.md](QUICK-START.md)

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ‰€æœ‰ API è°ƒç”¨

```javascript
page.on('response', response => {
  console.log('API:', response.url());
});
```

### ä½¿ç”¨ Playwright Inspector

```bash
npx playwright test --debug
```

### æŸ¥çœ‹æµè§ˆå™¨ç•Œé¢

```bash
npx playwright test --headed
```

## ğŸ“‹ æœ€ä½³å®è·µ

1. **ä¸€æ¬¡ä¸€ä¸ª**: ç¡®ä¿æ¯ä¸ªæµ‹è¯•é€šè¿‡åå†ç»§ç»­ä¸‹ä¸€ä¸ª
2. **å¤ç”¨ä»£ç **: ä½¿ç”¨ helpers ä¸­çš„è¾…åŠ©å‡½æ•°
3. **æ¸…æ™°å‘½å**: æµ‹è¯•åç§°è¦èƒ½æ¸…æ¥šè¡¨è¾¾æµ‹è¯•å†…å®¹
4. **æ•°æ®éš”ç¦»**: ä½¿ç”¨ `test-data.json` ä¸­çš„æµ‹è¯•æ•°æ®
5. **åŠæ—¶æ›´æ–°**: å®Œæˆæµ‹è¯•åæ›´æ–°è¿›åº¦æ–‡æ¡£

## ğŸ”— ç›¸å…³èµ„æº

- **OpenAPI è§„èŒƒ**: `../openapi_new.yaml`
- **é¡¹ç›®æ–‡æ¡£**: `../docs/`
- **Playwright æ–‡æ¡£**: https://playwright.dev/

## ğŸ’¬ éœ€è¦å¸®åŠ©ï¼Ÿ

1. æŸ¥çœ‹ [QUICK-START.md](QUICK-START.md) çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹ [API-TESTING-GUIDE.md](API-TESTING-GUIDE.md) çš„æœ€ä½³å®è·µ
3. æŸ¥çœ‹å·²å®Œæˆçš„æµ‹è¯•ç¤ºä¾‹ï¼š
   - `api-tests/user/login.spec.js`
   - `api-tests/user/register.spec.js`

---

**å¼€å§‹æµ‹è¯•ä¹‹æ—…ï¼** ğŸš€

å»ºè®®ä» [QUICK-START.md](QUICK-START.md) å¼€å§‹é˜…è¯»ã€‚
