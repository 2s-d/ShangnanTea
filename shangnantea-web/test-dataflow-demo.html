<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æµæµ‹è¯•æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #337ecc;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .error {
            background: #fef0f0;
            color: #f56c6c;
        }
        .success {
            background: #f0f9ff;
            color: #409EFF;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®æµé€šæµ‹è¯•æ¼”ç¤º</h1>
    <p>è¿™ä¸ªé¡µé¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ç®€å•è„šæœ¬æµ‹è¯•Vueé¡¹ç›®çš„æ•°æ®æµé€šã€‚</p>
    
    <div class="test-section">
        <h3>ä½¿ç”¨è¯´æ˜</h3>
        <ol>
            <li>ç¡®ä¿Vueé¡¹ç›®æ­£åœ¨è¿è¡Œï¼ˆnpm run serveï¼‰</li>
            <li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€Vueé¡¹ç›®é¡µé¢</li>
            <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°</li>
            <li>å¤åˆ¶å¹¶ç²˜è´´ä¸‹é¢çš„è„šæœ¬åˆ°æ§åˆ¶å°</li>
            <li>è¿è¡Œæµ‹è¯•å‡½æ•°</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•è„šæœ¬</h3>
        <button onclick="copyScript()">å¤åˆ¶è„šæœ¬åˆ°å‰ªè´´æ¿</button>
        <div class="result" id="script-content">
// è·å–Vueåº”ç”¨å®ä¾‹çš„store
function getStore() {
  // æ–¹æ³•1ï¼šä»Vue DevToolsè·å–
  if (window.__VUE_DEVTOOLS_GLOBAL_HOOK__ && window.__VUE_DEVTOOLS_GLOBAL_HOOK__.apps) {
    const app = window.__VUE_DEVTOOLS_GLOBAL_HOOK__.apps[0]
    if (app && app.config.globalProperties.$store) {
      return app.config.globalProperties.$store
    }
  }
  
  // æ–¹æ³•2ï¼šä»å…¨å±€å˜é‡è·å–ï¼ˆå¦‚æœé¡¹ç›®æœ‰è®¾ç½®ï¼‰
  if (window.$store) {
    return window.$store
  }
  
  // æ–¹æ³•3ï¼šä»Vueå®ä¾‹è·å–
  const app = document.querySelector('#app').__vue_app__
  if (app && app.config.globalProperties.$store) {
    return app.config.globalProperties.$store
  }
  
  throw new Error('æ— æ³•è·å–Vuex storeï¼Œè¯·ç¡®ä¿Vueåº”ç”¨å·²å¯åŠ¨')
}

// æµ‹è¯•ç”¨æˆ·ç™»å½•æ•°æ®æµ
async function testUserLogin() {
  try {
    console.log('ğŸ§ª æµ‹è¯•ç”¨æˆ·ç™»å½•...')
    const store = getStore()
    const result = await store.dispatch('user/login', {
      username: 'testuser',
      password: 'test123'
    })
    console.log('âœ… ç™»å½•æˆåŠŸ:', result)
    return result
  } catch (error) {
    console.log('âŒ ç™»å½•å¤±è´¥:', error.message)
    return null
  }
}

// æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯æ•°æ®æµ
async function testGetUserInfo() {
  try {
    console.log('ğŸ§ª æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯...')
    const store = getStore()
    const result = await store.dispatch('user/getUserInfo')
    console.log('âœ… è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ:', result)
    return result
  } catch (error) {
    console.log('âŒ è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error.message)
    return null
  }
}

// æµ‹è¯•è·å–åœ°å€åˆ—è¡¨æ•°æ®æµ
async function testGetAddresses() {
  try {
    console.log('ğŸ§ª æµ‹è¯•è·å–åœ°å€åˆ—è¡¨...')
    const store = getStore()
    const result = await store.dispatch('user/fetchAddresses')
    console.log('âœ… è·å–åœ°å€åˆ—è¡¨æˆåŠŸ:', result)
    return result
  } catch (error) {
    console.log('âŒ è·å–åœ°å€åˆ—è¡¨å¤±è´¥:', error.message)
    return null
  }
}

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
async function runAllTests() {
  console.log('ğŸš€ å¼€å§‹æ•°æ®æµé€šæµ‹è¯•...')
  await testUserLogin()
  await testGetUserInfo()
  await testGetAddresses()
  console.log('ğŸ æµ‹è¯•å®Œæˆ')
}

// å¯¼å‡ºæµ‹è¯•å‡½æ•°
window.testDataFlow = {
  testUserLogin,
  testGetUserInfo,
  testGetAddresses,
  runAllTests
}

console.log('ğŸ“‹ æ•°æ®æµæµ‹è¯•è„šæœ¬å·²åŠ è½½ï¼Œä½¿ç”¨æ–¹æ³•ï¼š')
console.log('- testDataFlow.testUserLogin() - æµ‹è¯•ç™»å½•')
console.log('- testDataFlow.testGetUserInfo() - æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯')
console.log('- testDataFlow.testGetAddresses() - æµ‹è¯•è·å–åœ°å€')
console.log('- testDataFlow.runAllTests() - è¿è¡Œæ‰€æœ‰æµ‹è¯•')
        </div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•å‘½ä»¤</h3>
        <p>è„šæœ¬åŠ è½½åï¼Œåœ¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
        <div class="result">
// æµ‹è¯•å•ä¸ªåŠŸèƒ½
testDataFlow.testUserLogin()
testDataFlow.testGetUserInfo()
testDataFlow.testGetAddresses()

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
testDataFlow.runAllTests()
        </div>
    </div>

    <div class="test-section">
        <h3>é¢„æœŸç»“æœ</h3>
        <p>å¦‚æœæ•°æ®æµé€šæ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š</p>
        <div class="result success">
ğŸ§ª æµ‹è¯•ç”¨æˆ·ç™»å½•...
âœ… ç™»å½•æˆåŠŸ: {token: "...", userInfo: {...}}

ğŸ§ª æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯...
âœ… è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ: {...}

ğŸ§ª æµ‹è¯•è·å–åœ°å€åˆ—è¡¨...
âœ… è·å–åœ°å€åˆ—è¡¨æˆåŠŸ: [...]
        </div>
        
        <p>å¦‚æœå‡ºç°é”™è¯¯ï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>
        <div class="result error">
âŒ ç™»å½•å¤±è´¥: Network Error
âŒ è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: 401 Unauthorized
        </div>
    </div>

    <script>
        function copyScript() {
            const scriptContent = document.getElementById('script-content').textContent;
            navigator.clipboard.writeText(scriptContent).then(() => {
                alert('è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶è„šæœ¬å†…å®¹');
            });
        }
    </script>
</body>
</html>