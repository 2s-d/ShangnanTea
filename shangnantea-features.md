# 商南茶文化推广与销售平台功能规划

## 项目概述
商南茶文化推广与销售平台是一个集茶叶销售、文化推广、社区交流于一体的综合平台，旨在为茶叶生产商、销售商和爱好者提供一个一站式服务平台。通过本平台，用户可以了解茶文化知识，购买优质茶叶，参与茶文化交流，商家可以进行茶叶销售和品牌推广。

## 用户角色设计

系统中有三种主要用户角色，每种角色拥有不同的顶部导航栏布局和权限：

1. **普通用户**：
   - 导航栏：茶文化-茶叶商城-茶友论坛-我的订单-消息管理-个人主页-购物车-下滑栏
   - 下滑栏：点击右上角头像显示下拉菜单，包含个人设置(个性修改、修改密码、商家认证申请)、收货地址管理、退出登录
   - 功能：购买茶叶、参与社区讨论、查看茶文化知识、申请商家认证
   -禁止访问页面：用户管理页面、订单管理页面、商家店铺管理页面、内容管理页面、茶叶管理页面（未明确的页面禁止皆可访问）
2. **茶叶商家**：
   - 导航栏：茶文化-茶叶商城-茶友论坛-订单管理-商家店铺-消息管理-个人主页-购物车-下滑栏
   - 下滑栏：点击右上角头像显示下拉菜单，包含个人中心(修改个人资料、修改密码)、收货地址管理、退出登录
   - 功能：管理店铺茶叶商品、处理自己店铺订单、与用户交流、管理自己店铺
   -禁止访问页面：用户管理页面、内容管理页面、茶叶管理页面（未明确的页面禁止皆可访问）
3. **平台管理员**：
   - 导航栏：茶文化-茶叶管理-订单管理-内容管理-用户管理-消息管理-个人主页-购物车-下滑栏
   - 下滑栏：点击右上角头像显示下拉菜单，包含个人中心(修改个人资料、修改密码)、收货地址管理、退出登录
   - 功能：管理用户/商家、维护平台内容（内容管理中实现，包含论坛内容、茶文化内容管理）、审核店铺认证（用户管理中实现）、管理平台直售茶叶和平台订单
   -禁止访问页面：店铺管理页面（未明确的页面禁止皆可访问）
## 功能模块规划

### 1. 用户模块 (User Module)

#### 1.1 登录注册与账户安全
- 用户注册与登录(支持手机号、用户名)
- 密码修改与找回
- 账户安全设置
- 用户身份验证

#### 1.2 个人资料管理
- 基本信息维护(姓名、性别、生日等)
- 头像上传与修改
- 个人简介设置
- 联系方式管理

#### 1.3 收货地址管理
- 添加/编辑/删除收货地址
- 设置默认收货地址
- 地址验证与格式化
- 地址薄管理

#### 1.4 商家认证流程
- 普通用户在个人中心申请商家认证
- 提交认证材料(身份证、营业执照等)
- 管理员审核认证申请
- 系统自动向用户发送认证结果通知
- 用户确认通知后：
  - 如通过认证：用户角色变更为商家，系统自动创建店铺
  - 如被拒绝：保留认证信息，用户可修改后重新提交
- 认证申请表作为临时存储，不直接参与店铺创建
- 店铺ID在用户确认通知后动态生成

#### 1.5 用户管理（管理员功能）
- 用户列表查看与搜索
- 用户角色管理
- 账户状态控制（启用/禁用）
- 用户行为统计
- 商家认证申请处理

### 2. 茶叶模块 (Tea Module)

#### 2.1 茶叶分类管理
- 分类体系(绿茶、红茶、白茶等)
- 产地分类
- 工艺分类
- 季节分类

#### 2.2 茶叶商品管理（平台直售茶叶）
- 茶叶基本信息管理
- 茶叶多规格设置(不同重量、包装)
- 茶叶图片管理(主图、详情图)
- 库存与价格管理
- 茶叶分为：
  - 店铺茶叶：商家上传，关联特定店铺（在店铺模块中管理）
  - 平台直售茶叶：管理员上传，使用固定平台店铺ID

#### 2.3 茶叶商城
- **搜索功能设计**：
  - 顶部搜索栏支持切换搜索类型(茶叶/店铺)
  - 搜索结果根据类型自动切换显示模式
  - 支持多种筛选条件组合(价格区间、评分、销量等)
  - 根据搜索类型显示不同的筛选项

- **茶叶卡片设计**：
  - 采用方形布局，突出茶叶主图
  - 包含茶叶名称、价格、评分、销量信息
  - 显示所属店铺名称(可点击跳转)
  - 提供"加入购物车"快捷按钮
  - 点击茶叶卡片主体跳转至茶叶详情页

- **茶叶详情页设计**：
  - 顶部图片轮播展示茶叶多角度图片
  - 详细展示茶叶名称、价格、规格选择
  - 显示所属店铺信息，点击可跳转至店铺
  - 提供"联系客服"功能，直接与卖家沟通
  - 展示茶叶详情、用户评价等信息
  - 底部固定栏提供"加入购物车"和"立即购买"按钮

#### 2.4 茶叶浏览与推荐
- 多条件筛选(分类、价格、评分)
- 关键词搜索
- 排序(销量、价格、评分)
- 茶叶推荐(基于随机推荐，预留算法推荐接口)

### 3. 店铺模块 (Shop Module)

#### 3.1 店铺管理
- 店铺基本信息设置
- 店铺装修(首页、Banner)
- 店铺公告管理
- 经营数据统计(基本销售数据，无专门图表)

#### 3.2 店铺茶叶管理
- 商家茶叶上传与管理
- 规格与价格设置
- 库存管理
- 茶叶上下架操作
- 商品图片管理

#### 3.3 店铺运营
- 商品上下架管理
- 促销活动设置
- 客户数据分析

#### 3.4 店铺展示
- **店铺卡片设计**：
  - 采用长横条形式布局，突出店铺视觉形象
  - 包含店铺Logo、店铺名称、简介、评分和销量信息
  - 显示店铺特色茶叶缩略图(3-5个)
  - 点击店铺卡片跳转至对应店铺详情页

- **店铺详情页设计**：
  - 顶部展示店铺基本信息和宣传Banner
  - 提供店铺公告、联系方式等信息
  - 展示该店铺所有茶叶商品(使用茶叶卡片组件)
  - 提供店铺内部搜索功能
  - 包含"联系客服"按钮，跳转到聊天界面

- 店铺首页展示
- 商品列表展示
- 店铺评分与评价
- 店铺搜索与推荐

### 4. 订单模块 (Order Module)

#### 4.1 购物车管理
- 添加/移除商品
- 修改数量
- 选择规格
- 购物车结算

#### 4.2 订单流程
- **明确订单流程**：
  - 用户在茶叶详情页可添加购物车或立即购买
  - 购物车页面可以选择茶叶进行结算
  - 立即购买或购物车结算都会跳转到结算页
  - 在结算页确认订单信息（收货地址、支付方式等）后，生成订单（初始状态为待支付）
  - 生成订单后跳转到支付页面
  - 取消支付或10分钟未支付：订单状态变为已取消
  - 完成支付：订单状态变为待发货，进入我的订单/订单管理页面
  - 商家或管理员发货：订单状态变为待收货
  - 用户收货确认：订单状态变为已完成
  - 完成后用户可评价商品（可选择跳过评价）
- **订单处理权限分离**：
  - 管理员只能操作平台直售的订单
  - 商家只能操作自己店铺的订单
- **单商品订单设计**：
  - 订单只支持单个商品(可选规格和数量)
  - 便于单品退货和发货处理

#### 4.3 支付系统
- 多支付方式集成
- 支付安全保障
- 退款处理
- 交易流水管理

#### 4.4 订单管理
- 订单状态查询
- 订单历史记录
- 订单统计分析
- 订单导出

#### 4.5 茶叶评价系统
- 评价必须在订单完成后进行
- 用户订单完成后出现"待评价"操作
- 评价内容、评分与晒图功能
- 商家可在茶叶详情页回复客户评价
- 评价显示在茶叶详情页面

### 5. 论坛模块 (Forum Module)

论坛模块虽名为"论坛"，但实际承担了整个平台的内容功能，分为三个主要部分：主菜单茶文化(首页)、茶友论坛和内容管理功能。

#### 5.1 主菜单茶文化（首页功能）
- **定位**：以茶文化为主，拥有传统首页该有的功能
- **内容管理**：
  - 轮播广告展示(Banner管理)
  - 茶文化特色展示
  - 精选茶叶推荐
  - 茶艺体验区展示
  - 茶界动态与最新资讯
  - 合作伙伴展示
  - 茶文化知识文章(单向输出内容)
  - 产地介绍
  - 泡茶方法指南
  - 茶叶鉴赏
  - **设计特点**：
  - 视觉冲击力强的Banner区
  - 多区块内容模块展示
  - 提供到商城和论坛的导航入口
  - 只有管理员可通过内容管理进行编辑
- **权限特点**：
  - 只有管理员可进行内容管理和创建
  - 用户和商家可浏览、点赞、收藏
  - 属于静态内容，与论坛互动内容区分
#### 5.2 茶友论坛功能
- **定位**：用户社区交流平台，与茶文化首页并列同级
- **版块设置**：
  - 茶类主题区
  - 茶文化讨论区
  - 购买交流区
  - 活动专区
- **帖子功能**：
  - 发布/编辑/删除帖子
  - 帖子置顶/精华设置
  - 多级回复功能
  - 点赞/收藏功能
  - @用户功能
- **权限控制**：
  - 普通用户可发帖、回复、点赞
  - 管理员可管理所有帖子内容
  - 帖子回复无需审核(预留审核功能接口)


#### 5.3 内容管理功能（管理员功能）
- **定位**：管理员专用的内容维护中心
- **分为两部分**：
  - **主菜单茶文化管理**：
    - 首页Banner轮播图管理
    - 首页板块内容设置
    - 茶文化专栏文章管理
    - 推荐内容设置
  - **论坛管理**：
    - 论坛版块创建与管理
    - 帖子审核与管理
    - 用户发言监控
    - 内容违规处理
- **权限控制**：
  - 仅管理员(角色ID: 1)可访问
  - 在管理员导航栏的"内容管理"菜单下

### 6. 消息模块 (Message Module)

#### 6.1 消息模块导航结构
- **导航栏位置**：所有角色(普通用户、商家、管理员)导航栏中均有"消息管理"和"个人主页"入口
- **消息模块组织**：
  - "消息管理"：处理通知和即时聊天功能
  - "个人主页"：处理用户资料、关注和收藏管理功能

#### 6.2 消息管理功能
- **系统通知**：
  - **四种通知类型**：
    - 帖子回复或@通知：可跳转定位到相应内容
    - 纯文本通知：系统公告等纯文字信息
    - 带外部链接通知：可跳转到外部资源
    - 含操作通知：如商家认证确认通知，含操作按钮
  - 通知状态管理(已读/未读)
  - 通知分类展示
  - 批量处理(全部已读、删除等)

- **即时聊天与店铺客服**：
  - **聊天功能分类**：
    - 好友聊天：用户间私信交流
    - 客服咨询：用户与商家或平台客服交流
    - 店铺客服：茶叶详情页和店铺页面的客服咨询入口
  - 左侧会话对象栏，右侧聊天框布局
  - 历史消息查询
  - 图片发送功能
  - 未读消息提醒
  - 会话置顶和删除

#### 6.3 个人主页功能
- **个人主页设计**：
  - 个人基础信息展示(头像、用户名、简介等)
  - 用户动态展示(最近发帖、评论等)
  - 用户角色标识(普通用户/商家/管理员)
  - 商家用户展示店铺链接
  - 关注按钮(针对他人查看时)
  - 私信按钮(针对他人查看时)

- **关注与收藏管理**：
  - 关注列表：包含用户和店铺，点击可跳转至详情页
  - 收藏列表：包含商品和帖子，点击可查看详情
  - 收藏内容类型分类：
    - 茶文化内容收藏
    - 茶叶商品收藏
    - 论坛帖子收藏
  - 关注动态更新
  - 收藏内容管理
  - 分类筛选功能

- **发布内容管理**：
  - 用户发布的帖子列表
  - 用户的茶叶评价记录
  - 按时间排序和分类筛选
  - 编辑和删除自己的内容

- **数据统计**：
  - 用户注册时长
  - 获得的点赞/收藏总数
  - 发帖数量统计
  - 交易数据概览(对商家用户)

#### 6.4 用户互动管理
- 用户关注功能
- 内容点赞功能
- 用户行为记录
- 互动提醒系统

#### 6.5 消息模块页面组织
- **已创建页面**：
  - 消息通知页面(NotificationsPage)：系统通知的查看和管理
  - 聊天页面(ChatPage)：私信和客服功能的实现
- **待创建页面**：
  - 个人主页页面(ProfilePage)：个人资料和统计信息展示
  - 关注管理页面(FollowsPage)：管理关注的用户和店铺
  - 收藏管理页面(FavoritesPage)：管理收藏的内容、商品和帖子
  - 发布内容页面(PublishedContentPage)：管理发布的帖子和评价

## 核心业务流程

### 茶叶购买流程
1. 浏览/搜索茶叶商城
2. 查看茶叶详情
3. 选择规格和数量
4. 加入购物车或立即结算
5. 结算生成订单(待支付状态)
6. 选择收货地址和支付方式
7. 完成支付(状态变为待发货)
8. 等待商家发货(状态变为待收货)
9. 确认收货(状态变为已完成)
10. 评价商品

### 商家入驻流程
1. 注册普通账户
2. 在个人中心申请商家认证
3. 提交认证材料
4. 等待平台管理员审核
5. 收到系统通知认证结果
6. 确认通知，身份变更为商家
7. 系统自动创建店铺
8. 完善店铺信息
9. 上传茶叶商品
10. 店铺正式运营

### 社区互动流程
1. 通过茶文化首页了解基本茶文化知识
2. 浏览茶友论坛的各个主题区
3. 阅读感兴趣的帖子
4. 发表回复/评论
5. 发布新帖子讨论茶叶相关话题
6. 收藏/点赞有价值的内容
7. 关注感兴趣的用户/商家
8. 通过私信与其他茶友交流

## 权限控制设计

平台采用组合式权限控制架构，确保系统安全和功能访问控制的精细化管理。

### 基本权限体系

#### 角色权限划分
- **普通用户(角色ID: 2)**：可浏览商品、下单购买、参与社区讨论、申请商家认证
- **商家(角色ID: 3)**：继承普通用户权限，额外拥有店铺管理、商品管理、订单处理权限
- **管理员(角色ID: 1)**：系统最高权限，可管理所有内容，包括用户管理、内容审核、平台数据管理

#### 资源访问权限
- **页面级权限**：基于角色控制页面访问，如店铺管理页仅商家和管理员可访问
- **操作级权限**：基于角色控制按钮/功能的显示与使用，如下架商品功能仅对应商家和管理员可用
- **数据级权限**：控制数据访问范围，如商家只能查看自己店铺的订单

### 权限实现架构

#### 前端权限控制
1. **基于Token的认证体系**
   - 采用类JWT结构的token：`base64Payload.signature`
   - payload包含用户ID、用户名、角色ID和过期时间
   - 所有权限验证基于token中解析的用户信息
   - token存储于localStorage，自动附加到API请求

2. **路由访问控制**
   - 通过路由元数据定义访问权限要求：`meta: { roles: [1, 3] }`
   - 全局路由守卫验证用户权限：
     ```javascript
     // 检查用户是否有权限访问页面
     if (to.meta.roles && !to.meta.roles.includes(userInfo.role)) {
       // 无权限时重定向到403页面
       next('/403')
     }
     ```
   - 未登录用户访问受保护页面自动重定向到登录页

3. **组件级权限控制**
   - 使用自定义权限指令控制DOM元素显示：
     ```html
     <!-- 仅管理员可见 -->
     <div v-permission="{ roles: [1] }">管理员操作按钮</div>
     
     <!-- 商家和管理员可见 -->
     <div v-permission="{ roles: [1, 3] }">商家管理功能</div>
     ```
   - 使用权限工具函数在组件逻辑中判断权限：
     ```javascript
     // 检查是否有管理员权限
     if (permission.isAdmin()) {
       // 执行管理员特有操作
     }
     ```

#### 后端权限控制
1. **接口访问控制**
   - 实现拦截器验证token有效性
   - 基于用户角色验证API访问权限
   - 无效token自动拒绝请求，返回401状态码

2. **数据访问控制**
   - 查询数据时自动添加用户/店铺ID过滤条件
   - 商家只能访问自己店铺相关数据
   - 防止越权操作他人数据

### 安全增强措施

1. **Token安全策略**
   - token有效期限制（默认24小时）
   - 敏感操作需二次验证（如修改密码）
   - 支持token黑名单机制（强制登出）
   - token定期刷新降低盗用风险

2. **数据传输安全**
   - API请求使用HTTPS加密传输
   - 敏感信息（如密码）不明文传输
   - 登录密码使用BCrypt加密存储

3. **防护机制**
   - 实现请求频率限制，防止暴力攻击
   - 防SQL注入和XSS攻击
   - 敏感操作添加图形验证码保护

## 技术特性规划

### 跨端支持
- 响应式Web设计
- 移动端适配
- 可扩展到小程序/APP

### 性能优化
- 数据库设计优化
- 图片懒加载
- 分页加载

### 安全性
- 数据加密传输
- 防止SQL注入
- 防止XSS攻击
- 接口限流

### 可扩展性
- 模块化设计
- 微服务架构准备
- API版本控制
- 预留算法推荐、积分优惠、审核机制等功能扩展接口

## 技术实现细节

### 技术栈选择
- **前端技术栈**：
  - 框架：Vue 3（已从Vue 2迁移）
  - 状态管理：Vuex 4
  - 路由：Vue Router 4
  - UI组件库：Element Plus
  - HTTP客户端：Axios
  - 构建工具：Vue CLI

- **后端技术栈**：
  - 框架：Spring Boot
  - ORM框架：MyBatis
  - 数据库：MySQL
  - 缓存：预留接口，暂不实现
  - 安全框架：自定义Token认证

### 文件存储方案
- **静态资源**：存储在前端项目的public目录
- **上传图片与视频**：存储在服务器端的`shangnantea\files`专用目录
- **文件组织结构**：
  ```
  files/
  ├── user/       # 用户头像等资源
  ├── shop/       # 店铺图片、认证材料
  ├── tea/        # 茶叶图片、详情图
  ├── article/    # 文章图片
  └── forum/      # 论坛帖子图片
  ```
- **文件命名规则**：使用UUID+原始扩展名方式命名，避免冲突

### 开发优先级
- **第一阶段**：完成PC端核心功能，不考虑移动端适配
- **第二阶段**：完善功能、优化体验
- **第三阶段**（未来规划）：移动端适配、性能优化、部署环境配置

### 代码组织
- **前端项目结构**：
  ```
  shangnantea-web/
  ├── public/              # 静态资源
  ├── src/
  │   ├── api/             # API接口
  │   ├── assets/          # 项目资源
  │   ├── components/      # 公共组件
  │   │   ├── common/      # 通用组件
  │   │   ├── user/        # 用户模块组件
  │   │   ├── tea/         # 茶叶模块组件
  │   │   ├── shop/        # 商店模块组件
  │   │   ├── order/       # 订单模块组件
  │   │   ├── forum/       # 论坛模块组件
  │   │   └── message/     # 消息模块组件
  │   ├── directives/      # 自定义指令
  │   ├── router/          # 路由配置
  │   ├── store/           # Vuex状态管理
  │   ├── utils/           # 工具类
  │   ├── views/           # 页面组件
  │   │   ├── user/        # 用户模块页面
  │   │   ├── tea/         # 茶叶模块页面
  │   │   ├── shop/        # 商店模块页面
  │   │   ├── order/       # 订单模块页面
  │   │   ├── forum/       # 论坛模块页面
  │   │   ├── message/     # 消息模块页面
  │   │   ├── home/        # 首页
  │   │   ├── auth/        # 认证页面
  │   │   └── error/       # 错误页面
  │   ├── composables/     # 组合式函数
  │   ├── App.vue          # 根组件
  │   └── main.js          # 入口文件
  ```

- **后端项目结构**：
  ```
  shangnantea-server/
  ├── src/main/java/com/shangnantea/
  │   ├── config/          # 配置类
  │   ├── controller/      # 控制器
  │   ├── mapper/          # 数据访问层
  │   ├── model/           # 实体类
  │   ├── service/         # 服务层
  │   └── util/            # 工具类
  ├── src/main/resources/
  │   ├── mapper/          # MyBatis映射文件
  │   ├── static/          # 静态资源
  │   └── application.yml  # 应用配置
  ```

### 部署考虑
- 暂不考虑复杂部署策略，项目完成后再确定具体部署方案
- 数据库使用现有备份，无需创建初始化脚本

### 组件目录重构设计

为提高代码组织结构的清晰度和可维护性，项目按照六大核心业务模块进行目录重构：

#### 组件目录结构设计原则

1. **模块化原则**：组件和页面按照业务模块分组，每个业务模块对应独立目录
2. **职责单一原则**：每个组件和页面只负责单一功能，避免代码混杂
3. **层次清晰原则**：使用子目录区分不同类型的组件，如列表、详情、管理等
4. **一致性原则**：所有模块保持一致的目录命名和组织方式

#### 目录组织结构

- **组件结构**：根据业务领域分为六大模块
  ```
  components/
  ├── common/      # 通用组件(如导航栏、页脚等)
  ├── user/        # 用户相关组件
  │   ├── profile/ # 个人资料相关组件
  │   └── address/ # 地址管理相关组件
  ├── tea/         # 茶叶相关组件
  │   └── card/    # 茶叶卡片组件
  ├── shop/        # 店铺相关组件
  │   └── card/    # 店铺卡片组件
  ├── order/       # 订单相关组件
  │   ├── cart/    # 购物车相关组件
  │   └── list/    # 订单列表相关组件
  ├── forum/       # 论坛相关组件
  │   ├── post/    # 帖子相关组件
  │   └── topic/   # 主题相关组件
  └── message/     # 消息相关组件
      ├── chat/    # 聊天相关组件
      └── notification/ # 通知相关组件
  ```

- **页面结构**：同样按业务模块分类，保持与组件结构对应
  ```
  views/
  ├── user/        # 用户相关页面
  │   ├── profile/ # 个人资料页面
  │   ├── address/ # 地址管理页面
  │   ├── manage/  # 用户管理页面(管理员)
  │   └── change-password/ # 密码修改页面
  ├── tea/         # 茶叶相关页面
  │   ├── list/    # 茶叶列表页面
  │   ├── detail/  # 茶叶详情页面
  │   └── manage/  # 茶叶管理页面
  ├── shop/        # 店铺相关页面
  │   ├── detail/  # 店铺详情页面
  │   └── manage/  # 店铺管理页面
  ├── order/       # 订单相关页面
  │   ├── cart/    # 购物车页面
  │   ├── list/    # 订单列表页面
  │   ├── manage/  # 订单管理页面
  │   └── payment/ # 支付页面
  ├── forum/       # 论坛相关页面
  │   ├── list/    # 论坛列表页面
  │   └── manage/  # 论坛管理页面
  ├── message/     # 消息相关页面
  ├── home/        # 首页
  ├── auth/        # 登录注册页面
  └── error/       # 错误页面
  ```

#### 重构优势

1. **提高开发效率**：
   - 快速定位相关组件和页面
   - 清晰的组件命名和位置
   - 降低代码搜索时间

2. **增强可维护性**：
   - 相关功能集中在同一模块
   - 减少跨模块依赖
   - 便于功能模块的独立更新

3. **促进代码复用**：
   - 组件层次分明，便于发现可复用组件
   - 相似功能组件集中管理，易于比较和优化
   - 降低重复开发类似功能的可能性

4. **简化团队协作**：
   - 开发者可以并行处理不同模块
   - 明确的责任边界减少冲突
   - 便于代码审查和质量控制 

#### 重构后续工作

重构完成后，需要进行以下工作：

1. **组件导入路径更新**：
   - 修改所有页面中引用组件的导入路径
   - 确保路径与新的目录结构一致
   - 测试所有页面能正常加载组件

2. **测试与验证**：
   - 检查路由配置是否正确指向新的页面位置
   - 验证所有功能在重构后保持正常
   - 修复任何因路径变更导致的问题

3. **文档更新**：
   - 更新组件使用文档，反映新的目录结构
   - 更新开发指南，说明新的项目组织方式
   - 提供组件示例和使用说明

4. **旧目录清理**：
   - 确认所有组件和页面已移动到新位置
   - 移除不再使用的旧目录
   - 确保不删除有用的源代码文件 