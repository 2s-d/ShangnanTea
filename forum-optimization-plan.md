# 论坛模块优化修复计划

## 修复范围
中优先级和低优先级问题的修复

---

## 🎯 修复任务列表

### 任务1：规范状态管理（问题6）
**优先级**：中
**工作量**：小

**修复内容**：
1. 创建PostStatus常量类，定义所有帖子状态
2. 创建ReplyStatus常量类，定义所有回复状态
3. 替换代码中的魔法数字

**涉及文件**：
- 新建：`com.shangnantea.constants.PostStatus`
- 新建：`com.shangnantea.constants.ReplyStatus`
- 修改：`ForumServiceImpl.java`

---

### 任务2：统一审核机制（问题4/5）
**优先级**：中
**工作量**：中

**修复内容**：
1. 明确审核规则：普通用户发帖需要审核，管理员直接通过
2. 修改createPost方法，根据用户角色设置初始状态
3. 修改createReply方法（如果需要回复审核）
4. 确保审核接口能正常工作

**涉及文件**：
- 修改：`ForumServiceImpl.java` - createPost, createReply方法

---

### 任务3：实现版主功能（问题3）
**优先级**：中
**工作量**：小

**修复内容**：
1. 在createTopic时允许设置版主
2. 在updateTopic时允许修改版主
3. 验证版主用户是否存在

**涉及文件**：
- 修改：`CreateTopicDTO.java` - 添加userId字段
- 修改：`UpdateTopicDTO.java` - 添加userId字段
- 修改：`ForumServiceImpl.java` - createTopic, updateTopic方法

---

### 任务4：数据一致性保障（问题1/7/8）
**优先级**：中
**工作量**：中

**修复内容**：
1. 添加数据校验方法，检查计数字段是否准确
2. 添加数据修复方法，重新统计计数字段
3. 明确计数规则（是否包含软删除的记录）

**涉及文件**：
- 新建：`ForumDataFixService.java` - 数据修复服务
- 新建：`ForumDataFixController.java` - 数据修复接口（管理员专用）

---

### 任务5：性能优化 - 批量查询用户（问题9）
**优先级**：低
**工作量**：中

**修复内容**：
1. 修改getForumPosts方法，批量查询用户信息
2. 修改getPostReplies方法，批量查询用户信息
3. 修改getArticles方法，批量查询作者信息

**涉及文件**：
- 修改：`ForumServiceImpl.java` - getForumPosts, getPostReplies, getArticles方法

---

### 任务6：代码重构 - 统一URL生成（问题10）
**优先级**：低
**工作量**：小

**修复内容**：
1. 创建VO转换工具类
2. 统一处理图片URL生成逻辑
3. 减少代码重复

**涉及文件**：
- 新建：`ForumVOConverter.java` - VO转换工具类
- 修改：`ForumServiceImpl.java` - 使用工具类替代重复代码

---

## 📋 执行顺序

建议按以下顺序执行：

1. **任务1：规范状态管理** ⭐ 先做，影响后续任务
2. **任务2：统一审核机制** ⭐ 依赖任务1
3. **任务3：实现版主功能** 
4. **任务6：代码重构** - 先重构，再优化
5. **任务5：性能优化** - 依赖任务6
6. **任务4：数据一致性保障** - 最后做，需要完整的业务逻辑

---

## ⚠️ 注意事项

1. **不修改数据库表结构**
2. **保持向后兼容**
3. **所有修改都要有日志记录**
4. **修改后要更新接口开发流程指南**
5. **每个任务完成后进行测试**

---

## 🚀 开始执行

准备好后，我们将逐个任务进行修复。每完成一个任务，我会汇报修改的文件和实现的功能。
