# æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿå…¨æµç¨‹æŒ‡å—

> **æ–‡æ¡£å®šä½**ï¼šè¿™æ˜¯ä¸€ä»½å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ç³»ç»ŸæŒ‡å¯¼æ–‡æ¡£ï¼Œè®°å½•äº†é¡¹ç›®ä¸­æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ æ¥å£çš„è®¾è®¡æ€è·¯ã€å®ç°æ–¹æ¡ˆå’ŒæŠ€æœ¯ç»†èŠ‚ã€‚
> 
> **ä½¿ç”¨è¯´æ˜**ï¼š
> - ğŸ”´ **å¿…é¡»æŒæ¡** - æ ¸å¿ƒæµç¨‹ï¼Œå¿…é¡»æ¸…æ™°ç†è§£
> - ğŸŸ¡ **éœ€è¦äº†è§£** - é‡è¦æ¦‚å¿µï¼Œäº†è§£å­˜åœ¨å³å¯
> - ğŸŸ¢ **å‚è€ƒèµ„æ–™** - è¾…åŠ©ä¿¡æ¯ï¼Œéœ€è¦æ—¶æŸ¥é˜…
>
> **âš ï¸ é‡è¦ï¼šæ–‡æ¡£åŒæ­¥ç»´æŠ¤åŸåˆ™**
> 
> æœ¬æ–‡æ¡£è®°å½•äº†æˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿçš„å®Œæ•´è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
> - 9ä¸ªå›¾ç‰‡ä¸Šä¼ æ¥å£çš„è¯¦ç»†ä¿¡æ¯
> - ç»Ÿä¸€çš„æ–‡ä»¶å¤„ç†å·¥å…·ç±»
> - åˆ†ç±»å­˜å‚¨ç­–ç•¥
> - æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ
> - å®Œæ•´çš„ä¸šåŠ¡æµç¨‹
> 
> **ç»™ AI çš„å…³é”®æç¤º**ï¼šå½“ä½ åœ¨å·¥ä½œä¸­å‘ç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œ**å¿…é¡»ä¸»åŠ¨æ›´æ–°æœ¬æ–‡æ¡£**ï¼š
> - âœ… æ–°å¢äº†å›¾ç‰‡ä¸Šä¼ æ¥å£
> - âœ… ä¿®æ”¹äº†æ–‡ä»¶å­˜å‚¨è·¯å¾„è§„åˆ™
> - âœ… æ›´æ–°äº†FileUploadUtilså·¥å…·ç±»
> - âœ… æ”¹å˜äº†æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ
> - âœ… å‘ç°æ–‡æ¡£å†…å®¹ä¸å®é™…ä»£ç ä¸ç¬¦
> 
> è¿™æ ·æ‰èƒ½ç¡®ä¿åç»­ä¸¢å¤±ä¸Šä¸‹æ–‡çš„ AI èƒ½å¤Ÿå‡†ç¡®ç†è§£æˆ‘ä»¬çš„è®¾è®¡æ€è·¯ï¼Œç›´æ¥ç»§ç»­å¼€å‘ã€‚

## ç›®å½•

- [ğŸ”´ å›¾ç‰‡ä¸Šä¼ æ¥å£ç»Ÿè®¡ï¼ˆå¿…è¯»ï¼‰](#-å›¾ç‰‡ä¸Šä¼ æ¥å£ç»Ÿè®¡å¿…è¯»)
- [ğŸ”´ æ–‡ä»¶ä¸Šä¼ å…¨æµç¨‹](#-æ–‡ä»¶ä¸Šä¼ å…¨æµç¨‹)
- [ğŸ”´ å·¥å…·ç±»ä½¿ç”¨æŒ‡å—](#-å·¥å…·ç±»ä½¿ç”¨æŒ‡å—)
- [ğŸŸ¡ æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ](#-æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ)
- [ğŸŸ¡ æ–‡ä»¶å­˜å‚¨ç­–ç•¥](#-æ–‡ä»¶å­˜å‚¨ç­–ç•¥)
- [ğŸŸ¢ æ¥å£å®ç°æ¨¡æ¿](#-æ¥å£å®ç°æ¨¡æ¿)
- [ğŸŸ¢ å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–](#-å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–)

---

## ğŸ”´ å›¾ç‰‡ä¸Šä¼ æ¥å£ç»Ÿè®¡ï¼ˆå¿…è¯»ï¼‰

### æ¥å£æ€»è§ˆ

**é¡¹ç›®å…±æœ‰ 9 ä¸ªå›¾ç‰‡ä¸Šä¼ æ¥å£**ï¼Œé‡‡ç”¨ç»Ÿä¸€çš„æŠ€æœ¯æ–¹æ¡ˆï¼š

| åºå· | æ¥å£åç§° | Typeåˆ†ç±» | æ•°æ®åº“è¡¨ | å­˜å‚¨å­—æ®µ | ä¸šåŠ¡åœºæ™¯ |
|------|----------|----------|----------|----------|----------|
| 1 | uploadAvatar | avatars | users | avatar | ç”¨æˆ·å¤´åƒä¸Šä¼  |
| 2 | uploadCertificationImage | certifications | shop_certifications | - | å•†å®¶è®¤è¯å›¾ç‰‡ |
| 3 | uploadTeaImages | teas | tea_images | image_url | èŒ¶å¶å›¾ç‰‡ä¸Šä¼  |
| 4 | uploadShopLogo | logos | shops | logo | åº—é“ºLogoä¸Šä¼  |
| 5 | uploadShopBanner | shop-banners | shop_banners | image_url | åº—é“ºè½®æ’­å›¾ |
| 6 | uploadReviewImage | reviews | tea_reviews | images | è®¢å•è¯„ä»·å›¾ç‰‡ |
| 7 | uploadBanner | forum-banners | home_contents | content | è®ºå›é¦–é¡µè½®æ’­å›¾ |
| 8 | sendImageMessage | messages | chat_messages | content | èŠå¤©å›¾ç‰‡æ¶ˆæ¯ |
| 9 | uploadPostImage | posts | forum_posts | images | è®ºå›å¸–å­å›¾ç‰‡ |

### çŠ¶æ€ç ç»Ÿè®¡

æ¯ä¸ªæ¥å£éƒ½æœ‰å¯¹åº”çš„æˆåŠŸå’Œå¤±è´¥çŠ¶æ€ç ï¼š

| æ¥å£ | æˆåŠŸç  | å¤±è´¥ç  | è¯´æ˜ |
|------|--------|--------|------|
| uploadAvatar | 2004 | 2109, 2110, 2111 | å¤´åƒæ›´æ–°æˆåŠŸ/å¤±è´¥ |
| uploadCertificationImage | 2024 | 2146, 2147, 2148 | è®¤è¯å›¾ç‰‡ä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| uploadTeaImages | 3014 | 3120, 3121, 3122 | èŒ¶å¶å›¾ç‰‡ä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| uploadShopLogo | 4007 | 4113, 4114, 4115 | Logoä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| uploadShopBanner | 4008 | 4117, 4118, 4119 | Bannerä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| uploadReviewImage | 5016 | 5144, 5145, 5146 | è¯„ä»·å›¾ç‰‡ä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| uploadBanner | 6001 | 6103, 6104, 6105 | è®ºå›Bannerä¸Šä¼ æˆåŠŸ/å¤±è´¥ |
| sendImageMessage | 7009 | 7116, 7117, 7118 | å›¾ç‰‡æ¶ˆæ¯å‘é€æˆåŠŸ/å¤±è´¥ |
| uploadPostImage | 6028 | 6140, 6141, 6142 | å¸–å­å›¾ç‰‡ä¸Šä¼ æˆåŠŸ/å¤±è´¥ |

### æŠ€æœ¯æ–¹æ¡ˆç»Ÿä¸€æ€§

**æ‰€æœ‰æ¥å£é‡‡ç”¨ç›¸åŒçš„æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- **å‰ç«¯**ï¼šä½¿ç”¨FormData + multipart/form-dataä¸Šä¼ 
- **åç«¯**ï¼šControlleræ¥æ”¶ â†’ Serviceå¤„ç† â†’ è°ƒç”¨FileUploadUtilså·¥å…·ç±»
- **å­˜å‚¨**ï¼šç»Ÿä¸€çš„æ–‡ä»¶å‘½åå’Œç›®å½•ç»“æ„
- **è¿”å›**ï¼šç»Ÿä¸€çš„å“åº”æ ¼å¼ {url, path}

---

## ğŸ”´ æ–‡ä»¶ä¸Šä¼ å…¨æµç¨‹

### æµç¨‹æ¦‚è§ˆ

```
å‰ç«¯ä¸Šä¼ æ–‡ä»¶
    â†“
Controlleræ¥æ”¶ (@RequestParam("file") MultipartFile file)
    â†“
Serviceå±‚å¤„ç†
    â”œâ”€ ç¡¬ç¼–ç typeï¼ˆå¦‚ "avatars", "posts", "messages"ï¼‰
    â”œâ”€ è°ƒç”¨å·¥å…·ç±»ï¼šFileUploadUtils.uploadImage(file, type)
    â”‚   â””â”€ å·¥å…·ç±»å¤„ç†ï¼š
    â”‚       â”œâ”€ éªŒè¯æ–‡ä»¶ï¼ˆç±»å‹ã€å¤§å°ï¼‰
    â”‚       â”œâ”€ ç”Ÿæˆæ–‡ä»¶åï¼ˆæ—¶é—´æˆ³+UUIDï¼‰
    â”‚       â”œâ”€ æ„å»ºè·¯å¾„ï¼ˆfiles/images/{type}/{year}/{month}/{day}/{filename}ï¼‰
    â”‚       â”œâ”€ ä¿å­˜æ–‡ä»¶ï¼ˆå‹ç¼©ã€å­˜å‚¨ï¼‰
    â”‚       â””â”€ è¿”å›ç›¸å¯¹è·¯å¾„
    â”œâ”€ ç”Ÿæˆè®¿é—®URL
    â””â”€ ä¸šåŠ¡é€»è¾‘å†³ç­–ï¼š
        â”œâ”€ åœºæ™¯1ï¼šç›´æ¥å­˜æ•°æ®åº“ï¼ˆå¦‚å¤´åƒï¼‰
        â”œâ”€ åœºæ™¯2ï¼šåªè¿”å›URLï¼ˆå¦‚å¸–å­å›¾ç‰‡ï¼Œç­‰å‘å¸–æ—¶å†å­˜ï¼‰
        â””â”€ åœºæ™¯3ï¼šä¸Šä¼ +ä¸šåŠ¡æ“ä½œï¼ˆå¦‚èŠå¤©å›¾ç‰‡ï¼Œä¸Šä¼ å¹¶åˆ›å»ºæ¶ˆæ¯ï¼‰
    â†“
è¿”å›Resultç»™å‰ç«¯
```

### ä¸‰ç§ä¸šåŠ¡åœºæ™¯

**åœºæ™¯1ï¼šç›´æ¥å­˜æ•°æ®åº“ï¼ˆå¦‚å¤´åƒä¸Šä¼ ï¼‰**
- ä¸Šä¼ æ–‡ä»¶ â†’ è°ƒç”¨å·¥å…·ç±» â†’ æ›´æ–°æ•°æ®åº“ â†’ è¿”å›ç»“æœ
- é€‚ç”¨æ¥å£ï¼šuploadAvatar, uploadShopLogo

**åœºæ™¯2ï¼šå…ˆè¿”å›URLï¼Œç¨åå­˜å‚¨ï¼ˆå¦‚å¸–å­å›¾ç‰‡ï¼‰**
- ä¸Šä¼ æ–‡ä»¶ â†’ è°ƒç”¨å·¥å…·ç±» â†’ è¿”å›URL â†’ ç”¨æˆ·å‘å¸–æ—¶å†å­˜æ•°æ®åº“
- é€‚ç”¨æ¥å£ï¼šuploadPostImage, uploadReviewImage

**åœºæ™¯3ï¼šä¸Šä¼ +ä¸šåŠ¡æ“ä½œï¼ˆå¦‚èŠå¤©å›¾ç‰‡ï¼‰**
- ä¸Šä¼ æ–‡ä»¶ â†’ è°ƒç”¨å·¥å…·ç±» â†’ åˆ›å»ºæ¶ˆæ¯è®°å½• â†’ è¿”å›ç»“æœ
- é€‚ç”¨æ¥å£ï¼šsendImageMessage

---

## ğŸ”´ å·¥å…·ç±»ä½¿ç”¨æŒ‡å—

### FileUploadUtilsæ ¸å¿ƒæ–¹æ³•

**ä¸»è¦ä¸Šä¼ æ–¹æ³•**ï¼š
```java
// åŸºç¡€ä¸Šä¼ ï¼ˆé»˜è®¤5MBé™åˆ¶ï¼‰
String relativePath = FileUploadUtils.uploadImage(file, "avatars");

// æŒ‡å®šå¤§å°é™åˆ¶
String relativePath = FileUploadUtils.uploadImage(file, "posts", 10 * 1024 * 1024);
```

**è¾…åŠ©æ–¹æ³•**ï¼š
```java
// ç”Ÿæˆè®¿é—®URL
String accessUrl = FileUploadUtils.generateAccessUrl(relativePath, baseUrl);

// åˆ é™¤æ–‡ä»¶
boolean success = FileUploadUtils.deleteFile(relativePath);
```

### æ–‡ä»¶å‘½åè§„åˆ™

**æ ¼å¼**ï¼š`æ—¶é—´æˆ³_UUID.æ‰©å±•å`
**ç¤ºä¾‹**ï¼š`20240118120530_abc123def456.jpg`

**ä¼˜ç‚¹**ï¼š
- é¿å…æ–‡ä»¶åå†²çª
- åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œä¾¿äºç®¡ç†
- ä¸ä¾èµ–åŸæ–‡ä»¶åï¼Œå®‰å…¨æ€§é«˜

### ç›®å½•ç»“æ„è§„åˆ™

**è·¯å¾„æ ¼å¼**ï¼š`files/images/{type}/{year}/{month}/{day}/{filename}`

**ç¤ºä¾‹**ï¼š
```
files/
  images/
    avatars/2024/01/18/20240118120530_abc123.jpg
    posts/2024/01/18/20240118120530_def456.jpg
    messages/2024/01/18/20240118120530_ghi789.jpg
```

**ä¼˜ç‚¹**ï¼š
- æŒ‰ä¸šåŠ¡ç±»å‹åˆ†ç±»å­˜å‚¨
- æŒ‰æ—¥æœŸåˆ†å±‚ï¼Œä¾¿äºç®¡ç†å’Œæ¸…ç†
- æ”¯æŒå¤§é‡æ–‡ä»¶å­˜å‚¨

### æ–‡ä»¶éªŒè¯è§„åˆ™

**æ”¯æŒçš„å›¾ç‰‡ç±»å‹**ï¼š
- MIMEç±»å‹ï¼šimage/jpeg, image/jpg, image/png, image/gif, image/webp
- æ‰©å±•åï¼š.jpg, .jpeg, .png, .gif, .webp

**æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š
- é»˜è®¤ï¼š5MB
- å¯è‡ªå®šä¹‰ï¼šé€šè¿‡å‚æ•°æŒ‡å®š

**å›¾ç‰‡å‹ç¼©**ï¼š
- è§¦å‘æ¡ä»¶ï¼šæ–‡ä»¶å¤§å° > 1MB
- å‹ç¼©è§„åˆ™ï¼šå®½åº¦å‹ç¼©åˆ°1200pxï¼Œä¿æŒæ¯”ä¾‹
- å‹ç¼©è´¨é‡ï¼š85%

---

## ğŸŸ¡ æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ

### å­˜å‚¨å­—æ®µç±»å‹

**å•ä¸ªå›¾ç‰‡å­—æ®µ**ï¼š
```sql
-- ç”¨æˆ·å¤´åƒ
users.avatar VARCHAR(255) -- å­˜å‚¨ç›¸å¯¹è·¯å¾„

-- åº—é“ºLogo
shops.logo VARCHAR(255) -- å­˜å‚¨ç›¸å¯¹è·¯å¾„

-- èŒ¶å¶ä¸»å›¾
teas.main_image VARCHAR(255) -- å­˜å‚¨ç›¸å¯¹è·¯å¾„
```

**å¤šå›¾ç‰‡JSONå­—æ®µ**ï¼š
```sql
-- è®ºå›å¸–å­å›¾ç‰‡
forum_posts.images TEXT -- JSONæ•°ç»„æ ¼å¼

-- èŒ¶å¶è¯„ä»·å›¾ç‰‡  
tea_reviews.images TEXT -- JSONæ•°ç»„æ ¼å¼

-- èŒ¶æ–‡åŒ–æ–‡ç« å›¾ç‰‡
tea_articles.images TEXT -- JSONæ•°ç»„æ ¼å¼
```

**ä¸“ç”¨å›¾ç‰‡è¡¨**ï¼š
```sql
-- èŒ¶å¶å›¾ç‰‡è¡¨
tea_images.image_url VARCHAR(255) -- å­˜å‚¨ç›¸å¯¹è·¯å¾„

-- åº—é“ºBannerè¡¨
shop_banners.image_url VARCHAR(255) -- å­˜å‚¨ç›¸å¯¹è·¯å¾„
```

**ç‰¹æ®Šå­˜å‚¨æ–¹å¼**ï¼š
```sql
-- èŠå¤©æ¶ˆæ¯ï¼ˆå›¾ç‰‡URLå­˜åœ¨contentå­—æ®µï¼‰
chat_messages.content TEXT -- å­˜å‚¨å®Œæ•´è®¿é—®URL
chat_messages.content_type VARCHAR(20) -- 'image'æ ‡è¯†

-- é¦–é¡µå†…å®¹ï¼ˆè½®æ’­å›¾ç­‰ï¼‰
home_contents.content TEXT -- å­˜å‚¨å›¾ç‰‡ç›¸å…³æ•°æ®
```

### å­˜å‚¨è·¯å¾„è§„åˆ™

**æ•°æ®åº“å­˜å‚¨**ï¼šç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ï¼š`files/images/avatars/2024/01/18/xxx.jpg`ï¼‰
**å‰ç«¯è®¿é—®**ï¼šå®Œæ•´URLï¼ˆå¦‚ï¼š`http://localhost:8080/files/images/avatars/2024/01/18/xxx.jpg`ï¼‰

**ä¼˜ç‚¹**ï¼š
- æ•°æ®åº“å­˜å‚¨ç©ºé—´å°
- åŸŸåå˜æ›´æ—¶æ— éœ€ä¿®æ”¹æ•°æ®åº“
- ä¾¿äºæ–‡ä»¶è¿ç§»

---

## ğŸŸ¡ æ–‡ä»¶å­˜å‚¨ç­–ç•¥

### å­˜å‚¨ä½ç½®

**å¼€å‘ç¯å¢ƒ**ï¼šé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `files/` æ–‡ä»¶å¤¹
**ç”Ÿäº§ç¯å¢ƒ**ï¼šå¯é…ç½®åˆ°ç‹¬ç«‹çš„æ–‡ä»¶æœåŠ¡å™¨æˆ–CDN

### æ¸…ç†ç­–ç•¥

**å®šæ—¶æ¸…ç†ä»»åŠ¡**ï¼ˆFileCleanupTaskï¼‰ï¼š
- **æ‰§è¡Œæ—¶é—´**ï¼šæ¯å¤©å‡Œæ™¨3ç‚¹
- **æ¸…ç†è§„åˆ™**ï¼šåˆ é™¤7å¤©å‰çš„å­¤å„¿æ–‡ä»¶
- **å®‰å…¨æ¨¡å¼**ï¼šå½“å‰åªè®°å½•æ—¥å¿—ï¼Œä¸è‡ªåŠ¨åˆ é™¤

**æ‰‹åŠ¨åˆ é™¤**ï¼š
- ä¸šåŠ¡åˆ é™¤æ—¶è°ƒç”¨ `FileUploadUtils.deleteFile()`
- ç«‹å³åˆ é™¤å¯¹åº”çš„ç‰©ç†æ–‡ä»¶

### è®¿é—®é…ç½®

**é™æ€èµ„æºæ˜ å°„**ï¼ˆWebMvcConfigï¼‰ï¼š
```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    registry.addResourceHandler("/files/**")
            .addResourceLocations("file:" + System.getProperty("user.dir") + "/files/");
}
```

**è®¿é—®URLæ ¼å¼**ï¼š`http://åŸŸå/files/images/{type}/{year}/{month}/{day}/{filename}`

---

## ğŸŸ¢ æ¥å£å®ç°æ¨¡æ¿

### Controllerå±‚æ¨¡æ¿

```java
/**
 * ä¸Šä¼ [ä¸šåŠ¡]å›¾ç‰‡
 * è·¯å¾„: POST /[æ¨¡å—]/[åŠŸèƒ½]/image
 * æˆåŠŸç : [xxxx], å¤±è´¥ç : [xxxx, xxxx, xxxx]
 */
@PostMapping("/[åŠŸèƒ½]/image")
@RequiresLogin
public Result<Map<String, Object>> upload[ä¸šåŠ¡]Image(@RequestParam("file") MultipartFile file) {
    logger.info("ä¸Šä¼ [ä¸šåŠ¡]å›¾ç‰‡è¯·æ±‚, æ–‡ä»¶å: {}", file.getOriginalFilename());
    return [æ¨¡å—]Service.upload[ä¸šåŠ¡]Image(file);
}
```

### Serviceå±‚æ¨¡æ¿

**åœºæ™¯1ï¼šç›´æ¥å­˜æ•°æ®åº“**
```java
@Override
public Result<Map<String, Object>> upload[ä¸šåŠ¡]Image(MultipartFile file) {
    try {
        // 1. è°ƒç”¨å·¥å…·ç±»ä¸Šä¼ ï¼ˆç¡¬ç¼–ç typeï¼‰
        String relativePath = FileUploadUtils.uploadImage(file, "[type]");
        
        // 2. ç”Ÿæˆè®¿é—®URL
        String baseUrl = "http://localhost:8080"; // ä»é…ç½®è¯»å–
        String accessUrl = FileUploadUtils.generateAccessUrl(relativePath, baseUrl);
        
        // 3. æ›´æ–°æ•°æ®åº“
        // ... ä¸šåŠ¡é€»è¾‘
        
        // 4. è¿”å›ç»“æœ
        Map<String, Object> result = new HashMap<>();
        result.put("url", accessUrl);
        result.put("path", relativePath);
        
        return Result.success([æˆåŠŸç ], result);
        
    } catch (BusinessException e) {
        return Result.failed([å¤±è´¥ç ]);
    }
}
```

**åœºæ™¯2ï¼šåªè¿”å›URL**
```java
@Override
public Result<Map<String, Object>> upload[ä¸šåŠ¡]Image(MultipartFile file) {
    try {
        // 1. è°ƒç”¨å·¥å…·ç±»ä¸Šä¼ 
        String relativePath = FileUploadUtils.uploadImage(file, "[type]");
        
        // 2. ç”Ÿæˆè®¿é—®URL
        String baseUrl = "http://localhost:8080";
        String accessUrl = FileUploadUtils.generateAccessUrl(relativePath, baseUrl);
        
        // 3. ç›´æ¥è¿”å›ï¼Œä¸å­˜æ•°æ®åº“
        Map<String, Object> result = new HashMap<>();
        result.put("url", accessUrl);
        result.put("path", relativePath);
        
        return Result.success([æˆåŠŸç ], result);
        
    } catch (BusinessException e) {
        return Result.failed([å¤±è´¥ç ]);
    }
}
```

### å‰ç«¯è°ƒç”¨æ¨¡æ¿

**APIå±‚**ï¼š
```javascript
export function upload[ä¸šåŠ¡]Image(file) {
  const formData = new FormData()
  formData.append('file', file)
  
  return request({
    url: API.[æ¨¡å—].[æ¥å£å¸¸é‡],
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    }
  })
}
```

**Storeå±‚**ï¼š
```javascript
async upload[ä¸šåŠ¡]Image({ commit }, file) {
  try {
    const res = await upload[ä¸šåŠ¡]Image(file)
    return res // è¿”å› {code, data: {url, path}}
  } catch (error) {
    commit('SET_ERROR', error.message || 'ä¸Šä¼ å›¾ç‰‡å¤±è´¥')
    throw error
  }
}
```

**ç»„ä»¶å±‚**ï¼š
```javascript
const handleUpload = async (file) => {
  try {
    const res = await store.dispatch('[æ¨¡å—]/upload[ä¸šåŠ¡]Image', file)
    if (res.code === [æˆåŠŸç ]) {
      // ä¸Šä¼ æˆåŠŸï¼Œä½¿ç”¨ res.data.url æ˜¾ç¤ºå›¾ç‰‡
      imageUrl.value = res.data.url
    }
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error)
  }
}
```

---

## ğŸŸ¢ å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–

### å¸¸è§é—®é¢˜

**Q1ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œæç¤º"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹"**
- æ£€æŸ¥æ–‡ä»¶MIMEç±»å‹æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
- æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦æ­£ç¡®

**Q2ï¼šæ–‡ä»¶è¿‡å¤§æ— æ³•ä¸Šä¼ **
- é»˜è®¤é™åˆ¶5MBï¼Œå¯é€šè¿‡å‚æ•°è°ƒæ•´
- æ£€æŸ¥æœåŠ¡å™¨ä¸Šä¼ å¤§å°é™åˆ¶

**Q3ï¼šå›¾ç‰‡æ˜¾ç¤ºä¸å‡ºæ¥**
- æ£€æŸ¥é™æ€èµ„æºæ˜ å°„é…ç½®
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦çœŸå®å­˜åœ¨

**Q4ï¼šæ•°æ®åº“è·¯å¾„å­—æ®µé•¿åº¦ä¸å¤Ÿ**
- å»ºè®®VARCHAR(255)ï¼Œè¶³å¤Ÿå­˜å‚¨å®Œæ•´è·¯å¾„

### æ€§èƒ½ä¼˜åŒ–

**å·²å®ç°çš„ä¼˜åŒ–**ï¼š
- è‡ªåŠ¨å›¾ç‰‡å‹ç¼©ï¼ˆ>1MBè§¦å‘ï¼‰
- æŒ‰æ—¥æœŸåˆ†å±‚å­˜å‚¨
- å®šæ—¶æ¸…ç†å­¤å„¿æ–‡ä»¶

**å¯è€ƒè™‘çš„ä¼˜åŒ–**ï¼š
- CDNåŠ é€Ÿ
- å›¾ç‰‡ç¼©ç•¥å›¾ç”Ÿæˆ
- å¼‚æ­¥ä¸Šä¼ å¤„ç†
- æ–‡ä»¶å»é‡

### å®‰å…¨è€ƒè™‘

**å·²å®ç°çš„å®‰å…¨æªæ–½**ï¼š
- æ–‡ä»¶ç±»å‹éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- è·¯å¾„éå†æ”»å‡»é˜²æŠ¤
- UUIDæ–‡ä»¶åé¿å…å†²çª

**å»ºè®®çš„å®‰å…¨æªæ–½**ï¼š
- å›¾ç‰‡å†…å®¹æ£€æµ‹
- ç—…æ¯’æ‰«æ
- è®¿é—®æƒé™æ§åˆ¶
- é˜²ç›—é“¾è®¾ç½®

---

## æ³¨æ„äº‹é¡¹

### å…³é”®åŸåˆ™

1. **typeåœ¨Serviceå±‚ç¡¬ç¼–ç **ï¼šæ¯ä¸ªæ¥å£çš„typeæ˜¯å›ºå®šçš„ï¼Œä¸ç”±å‰ç«¯ä¼ é€’
2. **ç»Ÿä¸€ä½¿ç”¨FileUploadUtils**ï¼šæ‰€æœ‰å›¾ç‰‡ä¸Šä¼ éƒ½é€šè¿‡å·¥å…·ç±»å¤„ç†
3. **ç›¸å¯¹è·¯å¾„å­˜æ•°æ®åº“**ï¼šä¾¿äºåŸŸåå˜æ›´å’Œæ–‡ä»¶è¿ç§»
4. **å®Œæ•´URLè¿”å›å‰ç«¯**ï¼šä¾¿äºå‰ç«¯ç›´æ¥ä½¿ç”¨

### å¼€å‘è§„èŒƒ

1. **æ–°å¢æ¥å£æ—¶**ï¼š
   - ç¡®å®štypeåˆ†ç±»
   - ç¡®å®šæ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ
   - æŒ‰ç…§æ¨¡æ¿å®ç°ä»£ç 
   - æ›´æ–°æœ¬æ–‡æ¡£

2. **ä¿®æ”¹å·¥å…·ç±»æ—¶**ï¼š
   - è€ƒè™‘å‘åå…¼å®¹æ€§
   - æ›´æ–°ç›¸å…³æ–‡æ¡£
   - æµ‹è¯•æ‰€æœ‰æ¥å£

3. **æ•°æ®åº“è®¾è®¡æ—¶**ï¼š
   - å›¾ç‰‡å­—æ®µä½¿ç”¨VARCHAR(255)
   - å¤šå›¾ç‰‡ä½¿ç”¨TEXTå­˜JSON
   - è€ƒè™‘æ˜¯å¦éœ€è¦ä¸“ç”¨å›¾ç‰‡è¡¨

### ç»™ AI çš„æç¤º

å¦‚æœä½ æ˜¯ AI æ¨¡å‹ï¼Œåœ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ ç›¸å…³ä»»åŠ¡æ—¶ï¼š

1. **ç†è§£ä¸šåŠ¡åœºæ™¯**ï¼šåŒºåˆ†ä¸‰ç§ä¸åŒçš„ä¸šåŠ¡åœºæ™¯
2. **éµå¾ªç»Ÿä¸€æ–¹æ¡ˆ**ï¼šæ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æ–¹æ¡ˆ
3. **ç¡¬ç¼–ç type**ï¼šåœ¨Serviceå±‚ç¡¬ç¼–ç ï¼Œä¸ç”±å‰ç«¯ä¼ é€’
4. **ä½¿ç”¨å·¥å…·ç±»**ï¼šå¿…é¡»é€šè¿‡FileUploadUtilså¤„ç†æ–‡ä»¶
5. **æ›´æ–°æ–‡æ¡£**ï¼šä¿®æ”¹ä»£ç ååŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£

---

## å‚è€ƒèµ„æ–™

- **å·¥å…·ç±»å®ç°**ï¼š`src/main/java/com/shangnantea/utils/FileUploadUtils.java`
- **å®šæ—¶ä»»åŠ¡**ï¼š`src/main/java/com/shangnantea/task/FileCleanupTask.java`
- **æ•°æ®åº“è¡¨ç»“æ„**ï¼š`teasystem.sql`
- **APIæ¥å£å®šä¹‰**ï¼š`../../../openapi_new.yaml`
- **çŠ¶æ€ç æ˜ å°„**ï¼š`../../../shangnantea-web/docs/tasks/code-message-mapping.md`

---

**æœ€åæ›´æ–°**ï¼š2026-01-21  
**ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ