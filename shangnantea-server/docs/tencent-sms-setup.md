# 腾讯云短信服务接入指南

## 一、注册腾讯云账号

1. 访问腾讯云官网：https://cloud.tencent.com
2. 点击"免费注册"
3. 完成个人实名认证（使用身份证）

---

## 二、开通短信服务

### 1. 进入短信控制台

1. 登录腾讯云控制台
2. 搜索"短信"或访问：https://console.cloud.tencent.com/smsv2
3. 点击"开通短信服务"

### 2. 创建短信应用

1. 在短信控制台，点击"应用管理" → "创建应用"
2. 填写应用名称：`商南茶城`
3. 填写应用简介：`商南茶文化推广与销售平台`
4. 点击"创建"
5. **记录 SDK AppID**（后面配置要用）

---

## 三、申请短信签名

### 1. 什么是短信签名？

短信签名是短信开头的【】内容，例如：【商南茶城】

### 2. 申请步骤

1. 在短信控制台，点击"国内短信" → "签名管理" → "创建签名"
2. 填写签名信息：
   - **签名类型**：选择"网站"
   - **签名用途**：选择"自用（签名为本账号实名认证的公司、网站、产品名等）"
   - **签名内容**：`商南茶城`
   - **证明类型**：选择"网站备案"（如果没有备案，选择"其他"）
   - **证明上传**：上传相关证明材料（如果是学生项目，可以上传学校证明或项目说明）
   - **申请说明**：`毕业设计项目，用于发送验证码短信`

3. 提交审核（通常1-2小时内审核完成）

**注意**：如果没有网站备案，可以选择"其他"类型，并在申请说明中详细说明是学生毕设项目。

---

## 四、申请短信模板

### 1. 什么是短信模板？

短信模板是短信的内容格式，例如：
```
您正在进行注册操作，验证码是：{1}，5分钟内有效，请勿泄露。
```

### 2. 申请步骤

1. 在短信控制台，点击"国内短信" → "正文模板管理" → "创建正文模板"
2. 填写模板信息：
   - **模板名称**：`验证码短信`
   - **短信类型**：选择"验证码"
   - **短信内容**：
     ```
     您的验证码是：{1}，5分钟内有效，请勿泄露。
     ```
   - **申请说明**：`用于用户注册、登录、重置密码等场景的验证码发送`

3. 提交审核（通常1-2小时内审核完成）
4. **记录模板ID**（审核通过后会显示，例如：`1234567`）

**注意**：
- `{1}` 是模板变量，代表验证码
- 验证码类型的模板审核最快，通常很快通过

---

## 五、获取API密钥

### 1. 创建密钥

1. 访问：https://console.cloud.tencent.com/cam/capi
2. 点击"新建密钥"
3. 完成身份验证
4. **记录 SecretId 和 SecretKey**（只显示一次，请妥善保存）

**重要**：SecretKey 只显示一次，请立即复制保存！

---

## 六、配置项目

### 1. 修改 `application.yml`

```yaml
tencent:
  sms:
    enabled: true  # 改为true启用真实发送
    secret-id: AKIDxxxxxxxxxxxxxxxxxxxxx  # 粘贴你的 SecretId
    secret-key: xxxxxxxxxxxxxxxxxxxxxxxx  # 粘贴你的 SecretKey
    sdk-app-id: 1400xxxxxx  # 粘贴你的 SDK AppID
    sign-name: 商南茶城  # 你的短信签名（不含【】）
    template-id: 1234567  # 你的模板ID
```

### 2. 重启项目

配置完成后重启Spring Boot项目即可。

---

## 七、测试

### 1. 模拟发送（默认）

```yaml
tencent:
  sms:
    enabled: false  # false表示模拟发送
```

- 不会真实发送短信
- 只在日志中打印
- 不消耗短信额度

### 2. 真实发送

```yaml
tencent:
  sms:
    enabled: true  # true表示真实发送
    secret-id: 你的SecretId
    secret-key: 你的SecretKey
    sdk-app-id: 你的SdkAppId
    sign-name: 商南茶城
    template-id: 你的模板ID
```

- 会真实发送短信到用户手机
- 消耗短信额度（约0.045元/条）

### 3. 测试接口

```bash
POST http://localhost:8080/api/user/verification-code/send
Content-Type: application/json

{
  "contact": "13800138000",
  "contactType": "phone",
  "sceneType": "register"
}
```

---

## 八、费用说明

### 1. 免费额度

- 新用户赠送100条免费短信
- 足够测试和演示使用

### 2. 正式使用

- 国内短信：0.045元/条
- 充值最低50元起
- 按量计费，用多少扣多少

### 3. 查看余额

访问：https://console.cloud.tencent.com/expense/overview

---

## 九、常见问题

### Q1: 签名审核不通过？

**A**: 
- 确保签名内容与你的项目相关
- 在申请说明中详细说明是学生毕设项目
- 可以上传学校证明或项目说明文档
- 如果实在不通过，可以尝试使用"测试"、"验证码"等通用签名

### Q2: 模板审核不通过？

**A**: 
- 验证码类型的模板通常很容易通过
- 确保模板内容简洁明了
- 不要包含营销内容
- 模板示例：`您的验证码是：{1}，5分钟内有效，请勿泄露。`

### Q3: 短信发送失败？

**A**: 
- 检查 SecretId 和 SecretKey 是否正确
- 检查 SDK AppID 是否正确
- 检查签名和模板是否已审核通过
- 检查账户余额是否充足
- 查看后端日志的详细错误信息

### Q4: 收不到短信？

**A**: 
- 检查手机号格式是否正确
- 确认手机号不在黑名单中
- 检查手机是否有信号
- 查看腾讯云控制台的发送记录

### Q5: 如何切换回模拟发送？

**A**: 
将 `tencent.sms.enabled` 改为 `false` 即可

---

## 十、代码说明

### 自动切换逻辑

```java
if (smsEnabled && tencentSecretId != null && !tencentSecretId.isEmpty()) {
    // 真实发送（腾讯云短信）
    return sendTencentSms(phone, code);
} else {
    // 模拟发送
    logger.info("【模拟发送短信】...");
    return true;
}
```

- `enabled=true` 且 `secret-id` 不为空 → 真实发送
- 其他情况 → 模拟发送

---

## 十一、优势

✅ 大厂服务，稳定可靠  
✅ 个人认证即可使用  
✅ 价格便宜（0.045元/条）  
✅ 新用户有100条免费额度  
✅ 审核速度快（1-2小时）  
✅ 接口文档完善  
✅ SDK 简单易用  

---

## 十二、申请流程总结

1. ✅ 注册腾讯云账号并实名认证
2. ✅ 开通短信服务
3. ✅ 创建短信应用（获取 SDK AppID）
4. ✅ 申请短信签名（等待审核）
5. ✅ 申请短信模板（等待审核）
6. ✅ 获取 API 密钥（SecretId 和 SecretKey）
7. ✅ 配置到 application.yml
8. ✅ 重启项目测试

---

## 十三、注意事项

1. **SecretKey 只显示一次**，请立即保存
2. **签名和模板需要审核**，通常1-2小时
3. **模板变量从 {1} 开始**，不是 {0}
4. **手机号需要加 +86 前缀**（代码已自动处理）
5. **测试时建议先用模拟模式**，确认逻辑正确后再启用真实发送

---

**配置完成后，你的验证码功能就能真实发送短信了！** 🎉

---

**最后更新时间**：2026-02-04
